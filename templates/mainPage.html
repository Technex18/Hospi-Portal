
{% load staticfiles %}
<html>
<head>
<link rel="stylesheet" href="{% static "css/jquery-ui.css" %}" type="text/css" media="all" />
<script src="{% static "jquery.min.js"%}"></script>
<script src="{% static "js/1.12.0jquery-ui.min.js" %}"></script>

</head>
<body>
<input type="text" id='email' />
<div id='response'>
</div>
<div id="section1">
	<form id='techProfile'>
		<input type='text' id='name' placeholder="Name" /><br>
		<input id='college' type='text' placeholder="College" /><br>
		<select id='year'>
			<option value = 1>1</option>
			<option value = 2>2</option>
			<option value = 3>3</option>
			<option value = 4>4</option>
			<option value = 5>5</option>
		</select>
		<br>
		<input id='mobileNumber' type='number' placeholder="mobile" /><br>
		<input id='city' type='text' placeholder="city" /><br>
		Gender:
		<select id='gender'>
			<option value=1>Male</option>
			<option value=0>Female</option>
			
		</select><br>
		<input type='checkbox' name='security' value=1 checked="true" />Security Fee Paid<br>
		<input type='checkbox' name='accom' value=1 />Accommodation <br>
		<select name='hostel' disabled="true">
{% for hostel in hostels %}
<option value="{{hostel.name}}">{{hostel.name}}(capacity = {{hostel.currentCapacity}} + {{hostel.bufferSize}})({{hostel.capacity}})
{% endfor %}
</select>
		<input type='button' id='registration' value='Register Info' />
		<br>
	</form>
	</div>




<hr>
<hr>

Hostel Alloted:<span id='hostelName'></span>
<br><br>
<select name='hostelChange'>
{% for hostel in hostels %}
<option value="{{hostel.name}}">{{hostel.name}}(capacity = {{hostel.currentCapacity}} + {{hostel.bufferSize}})({{hostel.capacity}})
{% endfor %}
</select>

<input type='button' id='hostelChangeButton' value='Allot Hostel' /> 
<div id='hostelResponse'></div>
<hr><hr>
<div id="section2">

<!-- <input type="checkbox" class="paymentscheck" id="security" value="200">Security Fee Paid(200)<br>
<input type="checkbox" class="paymentscheck" id="registration" value="800">Registration Fee(800)<br>
<input type="checkbox" class="paymentscheck" id="update" value="500">Update Accod(500)<br>
<input type="checkbox" class="paymentscheck" id="security" value="1300">Registration+Accod(1300)<br>
<input type="checkbox" class="paymentscheck" id="refund" value="-200">Refund Security Money<br>
<select id="extrapayment">
	<option value="0">jhdswjhsd</option>
	<option value="900">dkkdsjjksd</option>
</select>
<button type="button">Pay final Amount of Rs<strong id="total">0000</strong></button> -->
<button type="button" id="security">SECURITY FEE DEPOSIT(200)</button><br>
<button type="button" id="registration-only">REGISTRATION ONLY(800)</button><br>
<button type="button" id="accomodation-registration">ACCOMODATION + REGISTRATION(1300)</button><br>
<button type="button" id="upgrade-to-accod">UPGRATE TO ACCOMODATION(500)</button><br>
<select name='facilityName' id="facility">
	{% for facility in facilities %}
	<option value="{{facility.maxPrice}}">{{facility.name}}</option>
{% endfor %}
</select>
<input type="number" id="amount" name="amount">

<input type='button' id='payment' value='Pay !!' /><br>
<!-- <button type="button" id="other-payment">OTHER</button>
<div id="otherpayment" style="display: none;">
<input type="text" placeholder="payment description" id="otherpay-desc">
<input type="number" id="otherpay-amt">
</div> -->
</div>
<hr>
<hr>

<div id="section3">
	<div id='paymentHistory'>

	</div>
<button type="button">Tshirt given</button>
</div>
<hr>
<hr>

<div id="section4">
<button type="button">Generate OTP</button>
<h1>OR</h1>
<input type="text" id="submit"><button>Submit id number</button>
</div>
<hr>
<hr>



<!--
<form id='offLine'>
Gender:
	<select id='gender'>
			
			<option value=1>Male</option>
			<option value=0>Female</option>

		</select>
		<input type='checkbox' name='security' value=1 checked="true" />Security Fee Paid<br>
		<input type='checkbox' name='accom' value=1 />Accommodation <br>
		<input type="button" value='Register' />
</form>
-->
<script type="text/javascript">

function theAjax(uri,data){
 return $.ajax({
    type:"POST",
    dataType:"json",
    url: uri,
    data : data
 });
};


	$(function(){
   var availableTags = [
        {% for email in emails %}
            "{{email.0}}",
        {%endfor%}
      ];

 $("#email").autocomplete({
        source: availableTags
      });
    });
    // over write the default autocomplete function to match the option starting with term
    $.ui.autocomplete.filter = function (array, term) {
      var matcher = new RegExp("^" + $.ui.autocomplete.escapeRegex(term), "i");
      return $.grep(array, function (value) {
        return matcher.test(value.label || value.value || value);
      });
    };

function resetForm()
{
	$("#name").val("").attr("disabled",false);
	
	$("#college").val("").attr("disabled",false);
	$("#city").val("").attr('disabled', false);
	$("#mobileNumber").val("").attr('disabled', false);
	$("#year").val(1).attr('disabled', false);
	$("input[name=security]").attr('checked', true);
	$("input[name=accom]").attr('checked', false);
	$("select[name=hostel]").attr('disabled', true);
	$("#registration").attr('disabled', false);
}
$(document).ready(function() {
	$("#techProfile").hide();
	//$("#offLine").hide();
	$("#hostelChangeButton").click(function(event) {
		data = {
			"email":$("#email").val(),
			"hostelName":$("select[name=hostelChange]").val()
		};
		console.log(data);
		theAjax('/hostelChange/',data)
		.done(function(response){
			if(response['status'] == 1)
			{
			$("#hostelResponse").html("Hostel CHanged SuccessFully!!");
			$("#hostelName").html(response['hostelName']);
			$("#email").trigger('click');
		}
		else if(response['status'] == 2)
		{
			$("#hostelResponse").html("No transactions for the User!!(Hostel Cannot be alloted for users with 0 transaction)");

		}
		else{
			$("#hostelResponse").html("Hostel Already Filled!!(Select Other Hostel)");

		}
		});
	});
	$(".paymentscheck").on("click",function(){
			var x = $(".paymentscheck");
			var total=0;
			for(var i=0;i<x.length;i++)
			{
				if(x[i].checked==true)
				{
					total+= parseInt(x[i].value)
				}
			}
			// total+=$()
			total += parseInt($("#extrapayment").val());
			$("#total").html(total);
		})
	$("#extrapayment").on("click",function(){
			var x = $(".paymentscheck");
			var total=0;
			for(var i=0;i<x.length;i++)
			{
				if(x[i].checked==true)
				{
					total+= parseInt(x[i].value)
				}
			}
			// total+=$()
			total += parseInt($("#extrapayment").val());
			$("#total").html(total);
		})
	$("#email").on('keyup click blur',function(event)
	{
		data = {"email":$(this).val()}
		theAjax("/details/",data)
		.done(function(response){
			console.log(response)
			if(response['status'] == 0)
			{
				$("#response").html("Register The TechProfile");
				$("#techProfile").show();
				$("#paymentHistory").html(" ");
				resetForm();
				//$("#offLine").hide();
			}

			else if(response['status'] == 2)
			{
				$("#response").html("Already REgistered!!");
				html = ""
				response['paymentData'].forEach( function(element, index) {
					html +=  "Amount:  "+element['fields']['amount']+"      ";
					html += "Time:  "+element['fields']['timeStamp']+"       ";
					html += "Facility: "+element['fields']['facility']+"<br>";

				});
				html += "Total Transactions: " + response['total']+"<br>";
				$("#paymentHistory").html(html);
				//$("#offLine").show();
				$("#techProfile").show();
				$("#name").val(response['data']['name']).attr('disabled', true);
				$("#college").val(response['data']['college']).attr('disabled', true);
				$("#mobileNumber").val(response['data']['mobileNumber']).attr('disabled', true);
				$("#year").val(response['data']['year']).attr('disabled', true);
				$("#city").val(response['data']['city']).attr('disabled', true);
				$("#registration").attr('disabled', true);
				$("#hostelName").html(response['hostel'])
				//$("#techProfile").hide();
				//$("#offLine").hide();
			}
			else
			{
				$("#paymentHistory").html(" ");
				$("#response").html("Select Gender, TechProfile REgistered!!")
				//$("#offLine").show();
				$("#techProfile").show();
				$("#name").val(response['data']['name']).attr('disabled', true);
				$("#college").val(response['data']['college']).attr('disabled', true);
				$("#mobileNumber").val(response['data']['mobileNumber']).attr('disabled', true);
				$("#year").val(response['data']['year']).attr('disabled', true);
				$("#city").val(response['data']['city']).attr('disabled', true);
				
			}
		});
	});

	$("#payment").on("click",function(){
		data = {
			"facilityName": $("#facility option:selected").text(),
			"identifier" : $("#email").val(),
			"amount" : $("#amount").val(),
		}
		theAjax("/payment/",data)
		.done(function(response){
			console.log(response);
			$("#email").trigger('click');
		})
		.fail(function(){
			alert("ma chudao");
		})
	});

	$("#facility").on("click" , function(){
		// $("#amount").attr("value",);
		$("#amount").val(parseInt($('#facility option:selected').val()))
	})

	$("input[name=accom]").change(function(event) {
		if($(this).prop("checked"))
			$("select[name=hostel]").attr('disabled', false);
		else
			$("select[name=hostel]").attr('disabled', true);
	});
	$("#security").click(function(event) {
		x = $("#facility option");
		for(var i=0;i<x.length;i++)
		{
			if(x[i].text == "Security")
			{
				x.prop("selected","true");
		$("input[name='amount']").val(200);
		$("#payment").trigger("click");
			}
		}
	});
// $("#security").click(function(event) {
// 		x = $("#facility option");
// 		for(var i=0;i<x.length;i++)
// 		{
// 			if(x[i].text == "Security")
// 			{
// 				x.prop("selected","true");
// 		$("input[name='amount']").val(200);
// 		$("#payment").trigger("click");
// 			}
// 		}
// 	});
// $("#security").click(function(event) {
// 		x = $("#facility option");
// 		for(var i=0;i<x.length;i++)
// 		{
// 			if(x[i].text == "Security")
// 			{
// 				x.prop("selected","true");
// 		$("input[name='amount']").val(200);
// 		$("#payment").trigger("click");
// 			}
// 		}
// 	});
// $("#security").click(function(event) {
// 		x = $("#facility option");
// 		for(var i=0;i<x.length;i++)
// 		{
// 			if(x[i].text == "Security")
// 			{
// 				x.prop("selected","true");
// 		$("input[name='amount']").val(200);
// 		$("#payment").trigger("click");
// 			}
// 		}
// 	});

	$("#registration").click(function(event) {
		data = {
			
	"name":$("#name").val(),
	"college":$("#college").val(),
	"mobileNumber":$("#mobileNumber").val(),
	"email":$("#email").val(),
	"gender":$("#gender").val(),
	"year":$("#year").val(),
	"hostel":$("select[name=hostel]").val()

		}
		if($("input[name=security").prop("checked"))
		{
			data['security'] = 1;
		}
		else
		{
			data['security'] = 0;
		}
		if($("input[name=accom]").prop("checked"))
		{
			data['accom'] = 1;
		}
		else
		{
			data['accom'] = 0;
		}
		theAjax("/register/",data)
		.done(function(response){
			if(response['status'] == 1)
			{

				//$("#email").val("");
				html = ""
				response['paymentData'].forEach( function(element, index) {
					html +=  "Amount:  "+element['fields']['amount']+"      ";
					html += "Time:  "+element['fields']['timeStamp']+"       ";
					html += "Facility: "+element['fields']['facility']+"<br>";
				});
				$("#paymentHistory").html(html);
				$("#email").trigger('click');
				//resetForm();
				//$("#techProfile").hide();
			}
			else if(response['status'] == 0){
				$("#response").html("The Selected hostel is full !!!");
			}
			else
			{
				$("#response").html("Already REgistered");
			}
		})
		.fail(function(){
			$("#response").html("Please Assign Current Hostel!!!");
		})
	});



});


</script>
<script type="text/javascript">
	

	// $("#acomPay").click(function(event) {
	// 	if($("input[name=identifier]").val())
	// 	{
	// 	$("select[name='facilityName']").val("Accommodation");
	// 	$("input[name='amount']").val(1300);
	// 	$("#payment").trigger("click");
	// 	}
	// });
</script>
</body>
</html>